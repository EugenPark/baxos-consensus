syntax = "proto3";
option go_package = "common/";

message Command {
  string value = 1;
}

message WriteRequest {
  string unique_id = 1;
  Command command = 2;
  int64 sender = 3;
}

message ReadRequest {
  string unique_id = 1;
  int64 sender = 2;
}

message ReadResponse {
  string unique_id = 1;
  Command command = 2;
  int64 sender = 3;
}

message WriteResponse {
  string unique_id = 1;
  bool success = 2;
  int64 sender = 3;
}

message ReadPrepare {
  string unique_id = 1;
  int64 sender = 2;
}

message ReadPromise {
  string unique_id = 1;
  Command command = 2;
  int64 sender = 3;
  int64 index = 4;
}

/*
  Status is sent by a client to inform replicas about actions that include, but not limited to
  1. To establish connections to other nodes
  2. To write the logs to files
*/

message PrintLog {}

message Ballot {
  int32 number = 1;
  int32 replica_id = 2;
}

message PrepareRequest {
  int32 instance_number = 1;
  Ballot prepare_ballot = 2;
  int64 sender = 3;
}

message PromiseReply {
  int32 instance_number = 1;
  bool promise = 2;
  Ballot last_promised_ballot = 3;

  Ballot last_accepted_ballot = 4;
  WriteRequest last_accepted_value = 5;

  bool decided = 6; // if the current instance is already decided
  WriteRequest decided_value = 7;
  int64 sender = 8;
}

message DecideInfo {
  int32 instance_number = 1;
  WriteRequest decided_value = 2;
}

message ProposeRequest {
  int32 instance_number = 1;
  Ballot propose_ballot = 2;
  WriteRequest propose_value = 3;

  int64 sender = 4;
  DecideInfo decide_info = 5;
}

message AcceptReply {
  int32 instance_number = 1;
  bool accept = 2;
  Ballot accept_ballot = 3;

  bool decided = 4; // if the current instance is already decided
  WriteRequest decided_value = 5;

  int64 sender = 6;
}